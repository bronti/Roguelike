## Roguelike

### Общие сведения о системе

#### Обозначения

`@` - игрок.

`g` - гоблин. 

`#` - в зависимости от цвета: 

* `белый` - стена.
* `темно-серый` - пустой пол.

`.` - контейнер с предметами.
#### Управление

`esc` - сдаться.

`w` - перемещение вверх (или атаковать существо сверху).

`a` - перемещение влево (или атаковать существо слева).

`s` - перемещение вниз (или атаковать существо снизу).

`d` - перемещение вправо (или атаковать существо справа).

`стрелка вниз` - посмотреть вверх.

`стрелка влево` - посмотреть влево.

`стрелка вниз` - посмотреть вниз.

`стрелка вправо` - посмотреть вправо.

`l` - выбросить активный предмет из инвентаря.

`g` - взять активный предмет из контейнера в зоне видимости.

`i` - сделать активным следующий предмет в инвентаре.

`i` - сделать активным следующий предмет в контейнере в зоне видимости.

#### Замечания

Игра является пошаговой, то есть после действия, совершенного игроком, действия совершают по очереди все враги. Действиями являются только перемещения и атаки. После удачного перемещения зона видимости смещается на ту клетку, на которой находиться игрок.

### Architectural drivers

В процессе создания игры были учтены следующие требования:  
+ Персонаж игрока, способный перемещаться по карте, управляемый с клавиатуры  
+ Непосредственно стрелками (или дополнительной цифровой клавиатурой), не вводом команды  
+ Инвентарь персонажа, включающий элементы, влияющие на его характеристики, которые можно надеть и снять
+ Автоматически сгенерированная карта
+ Мобы, способные перемещаться по карте
+ Боевая система — движущиеся объекты, пытающиеся занять одну клетку карты, атакуют друг друга

### Роли и случаи использования

Игра предполагает единственную роль: **игрок**.  

Целью **игрока** является бессмысленно потратить как можно времени. Для этого он может ходить по карте (используя `wasd`) и атаковать противников (для этого достаточно попытаться занять клетку, на которой находится противник). Для повышения эффективности **игрок** может подбирать вещи, который остаются после убийства противников (`g`).

Если здоровье главного персонажа падает до нуля, то игра заканчивается, но, если **игрок** потрати еще не достаточно времени, он может продолжить играть, нажав `enter`.

#### Персонажи

1. Гарри Поттер
   * **Возраст:** 16
   * **Образование:** студент технической специальности
   * **Уровень владения компьютером:** высокий
   * **Личные качества:** все свободное время тратит на компьютерны игры, любит старые консольные игры, много читает по теме
   * **Особенности использования игры:** изучает игру вдоль и поперек, находит все пасхалки, может не отрываясь играть в игру несколько дней подряд
2. Северус Снейп
   * **Возраст:** 37
   * **Образование:** высшее
   * **Уровень владения компьютером:** высокий
   * **Личные качества:** много работает и сильно устает на работе, ответственный, собранный
   * **Особенности использования игры:** игра нужна для того, чтобы расслабиться после тяжелого рабочего дня; не тратит на игру много времени и  заинтересован не столько в достижении результата, сколько в самом процессе
3. Джинни Уизли
   * **Возраст:** 11
   * **Образование:** школьница
   * **Уровень владения компьютером:** низкий
   * **Личные качества:** безответственная, не очень прилежно учится 
   * **Особенности использования игры:** играет только с разрешения родителей по выходным; не может удержать внимание на одной и той же игре на долгое время, так что, скорее всего, бросит игру довольно скоро; больше заинтересованна в интересном сеттинге, чем в проработанной механике игры

### Композиция и логическая структура

![classes](/home/bronti/all/au/sd/roguelike/diagrams/classes.png)

Все сущности делятся на пять основных групп:

`Dungeon` отвечает за все, что связао с картой и расположением объектов. Здесь два самых важных класса: `Dungeon`, в котором хранится сама карта, и `OnMapOnject` -- базовый класс для всех объектов, которые можно поместить на карту. `DungeonBuilder` --  класс, с помощь которого генерируется карта. `Tile` - визуальное представление одной ячейки карты. `Place` -- координаты точки на карте.

`Creatures` -- существа, участвующие в игре. Здесь важным является класс `Creature` -- базовый для любого существа. У него есть два наследника -- `PlayerCharacter` и `NonPlayerCharacter` -- класс для персонажа игрока и для остальных персонажей (мобов), соответственно.

`Items` отвечает за представение предметов. Здесь главный интерфейс -- `Item`. Каждый из объектов типа `Item` может содержать в себе объекты типа `Armor` (броня) и `Melee` (оружие ближнего боя). `Hit` -- класс, представляющий силу одного удара по противнику. Для класса `Item` если свой билдер-класс -- `ItemBuilder`, позволяющий создать `Item` с заданным набором характеристик. Также есть класс `Container` (наследующийся от `Item`) -- класс, представляющий контейнер, который может находиться на карте и в котором могут храниться другие `Item`'ы. Соответствующий ему класс `StorableObject` -- базовый класс для объектов, которые можно хранить в контейнере. `Sack` --  наследник `Container`'а -- класс для инвентаря любого существа.

`Screens` -- экраны, на которых отображается игра. Первый экран -- `StartScreen` -- показывает пользователю приветствие. `DungeonScreen` -- основной экран, на котором происходит вся игра. `GameOverScreen` -- экран окончания игры. У всех экранов есть базовый класс `Screen`.

`Main` -- группа классов, отвечающих за состояние и течение всей игры, а так же за взаимодействие с пользователем. `ApplicationMain` -- точка входа, которая владеет контроллером. Контроллер `Controller` обрабатывает ввод игрока и иниччирует смену и обновление экранов. `GameState` -- класс, отвечающий за состояние игры. В частности, в нем хранится карта `Dungeon`. `ObjectsHolder` -- класс, в котором храняться все активные существа и объекты.

### Взаимодействия и состояние

#### Диаграмма последовательностей

![sequence](/home/bronti/all/au/sd/roguelike/diagrams/sequence.png)

#### Диаграмма конечных автоматов

![actions](/home/bronti/all/au/sd/roguelike/diagrams/automaton.png)